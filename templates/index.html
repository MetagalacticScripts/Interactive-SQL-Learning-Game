<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Candy Quest üç≠</title>
  <style>
    /* =======================
       Global Styles
       ======================= */
    body {
      margin: 0;
      padding: 20px;
      text-align: center;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: radial-gradient(circle, #ffe6f2, #ffeef8, #fff);
      color: #333;
    }
    h1 {
      font-size: 50px;
      color: #ff4081;
      text-shadow: 2px 2px #fff;
      margin: 10px 0;
    }
    h2 {
      font-size: 28px;
      color: #ff4081;
      text-shadow: 1px 1px #fff;
      margin-bottom: 20px;
    }
    h3 {
      color: #ff4081;
      font-size: 22px;
      margin: 10px 0;
    }

    /* =======================
       Character Select
       ======================= */
    .character-select button {
      background: #ff80ab;
      color: #fff;
      border: none;
      padding: 12px 25px;
      margin: 5px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      transition: background 0.3s;
    }
    .character-select button:hover {
      background: #ff4081;
    }

    /* =======================
       Game Board
       ======================= */
    .board {
      width: 900px;
      height: 700px;
      background: rgba(255, 255, 255, 0.9);
      margin: 30px auto;
      border-radius: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      border: 6px dashed #ff80ab;
    }
    .tiles {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* =======================
       Tiles
       ======================= */
    .tile {
      width: 100px;
      height: 100px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: bold;
      color: #fff;
      position: absolute;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
    }
    .tile:hover {
      transform: scale(1.05);
    }
    /* Pastel Candy Colors */
    .tile:nth-child(5n+1) { background: #ffb3ba; } /* Pink */
    .tile:nth-child(5n+2) { background: #bae1ff; } /* Blue */
    .tile:nth-child(5n+3) { background: #baffc9; } /* Green */
    .tile:nth-child(5n+4) { background: #ffdfba; } /* Orange */
    .tile:nth-child(5n+5) { background: #ffffba; } /* Yellow */

    .start-tile {
      background: #ffd700;
      font-size: 24px;
      color: #333;
    }

    /* =======================
       Player
       ======================= */
    #player {
      font-size: 80px; /* bigger icon */
      position: absolute;
      transition: left 0.5s ease-in-out, top 0.5s ease-in-out;
      z-index: 10;
    }

    /* =======================
       Controls
       ======================= */
    .controls button {
      background: #ff80ab;
      color: white;
      border: none;
      padding: 14px 30px;
      margin: 5px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      transition: background 0.3s;
    }
    .controls button:hover {
      background: #ff4081;
    }
    #hints-left {
      font-size: 20px;
      color: #ff4081;
      margin: 10px 0;
      text-shadow: 1px 1px #fff;
    }

    /* =======================
       Popup for Questions
       ======================= */
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 235, 205, 0.95);
      border-radius: 20px;
      padding: 25px;
      width: 500px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    .popup-content {
      background: #fff;
      border: 5px solid #ff80ab;
      padding: 20px;
      border-radius: 15px;
      position: relative; /* so close button can be positioned */
    }
    .popup h2 {
      color: #ff4081;
      font-size: 30px;
      margin-bottom: 15px;
    }
    .popup input {
      width: 90%;
      padding: 10px;
      margin: 15px 0;
      border: 2px solid #ff80ab;
      border-radius: 5px;
      font-size: 18px;
    }
    .popup-buttons button {
      background: #bae1ff;
      color: #333;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    .popup-buttons button:hover {
      background: #36a2eb;
    }
    /* Close (X) Button inside the popup */
    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #888;
      transition: color 0.3s;
    }
    .close-button:hover {
      color: #ff4081;
    }

    /* =======================
       Custom Message Popup
       ======================= */
    .message-popup {
      display: none;
      position: fixed;
      top: 55%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 5px solid #ff80ab;
      border-radius: 20px;
      width: 400px;
      padding: 20px;
      z-index: 2000;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }
    .message-popup-content {
      position: relative;
      padding: 20px;
      font-size: 18px;
    }
    .message-popup .close-button {
      top: 10px;
      right: 15px;
    }
    .message-popup p {
      margin: 0;
      padding: 10px 0;
      color: #555;
    }
    .ok-button {
      background: #bae1ff;
      color: #333;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    .ok-button:hover {
      background: #36a2eb;
    }
  </style>
</head>
<body>
  <h1>SQL Candy Quest üç≠</h1>
  <h2>Answer SQL challenges correctly to reach the Candy Castle! üè∞</h2>

  <!-- Character Selection -->
  <div class="character-select">
    <h3>Choose Your Character:</h3>
    <button onclick="selectCharacter('üç≠')">Lollipop</button>
    <button onclick="selectCharacter('üç¨')">Candy</button>
    <button onclick="selectCharacter('üç´')">Chocolate</button>
  </div>

  <!-- Game Board -->
  <div class="board">
    <div id="tiles-container" class="tiles"></div>
    <div id="player">üç≠</div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button onclick="getQuestion('easy')">Easy Path</button>
    <button onclick="getQuestion('medium')">Medium Path</button>
    <button onclick="getQuestion('advanced')">Advanced Path</button>
    <button onclick="resetPlayer()">Reset</button>
  </div>

  <div id="hints-left">Hints Left: 3</div>

  <!-- Popup for Questions -->
  <div id="question-popup" class="popup">
    <div class="popup-content">
      <!-- Close Button -->
      <button class="close-button" onclick="closePopup()">√ó</button>
      <h2>Sweet Challenge üç¨</h2>
      <p id="question-text"></p>
      <input type="text" id="answer" placeholder="Type your SQL query here...">
      <div class="popup-buttons">
        <button onclick="submitAnswer()">Submit</button>
        <button onclick="showHint()">Hint</button>
        <button onclick="showDatabaseSchema()">Show Database Schema</button>
        <button onclick="showAnswer()">Show Answer</button>
      </div>
    </div>
  </div>

  <!-- Custom Message Popup (replaces alerts) -->
  <div id="message-popup" class="message-popup">
    <div class="message-popup-content">
      <button class="close-button" onclick="closeMessagePopup()">√ó</button>
      <p id="message-text"></p>
      <button class="ok-button" onclick="closeMessagePopup()">OK</button>
    </div>
  </div>

  <script>
    /* ========================================
       GLOBAL VARIABLES & INITIAL SETUP
    ======================================= */
    let playerPosition = 0;
    const totalSpaces = 17;
    let hintsLeft = 3;
    let playerIcon = "üç≠"; // Default

    /* We'll track how many spaces to move based on difficulty. */
    let spacesToMove = 1;

    /* Adjust for bigger board */
    const tileSize = 100;
    const tileSpacing = 120;

    const tilePositions = [];

    // Generate tile positions in a 5-column layout
    for (let i = 0; i < totalSpaces; i++) {
      let x = 100 + (i % 5) * tileSpacing;
      let y = 100 + Math.floor(i / 5) * tileSpacing;
      tilePositions.push([x, y]);
    }

    /* ========================================
       GENERATE TILES
    ======================================= */
    function generateTiles() {
      const tilesContainer = document.getElementById("tiles-container");
      tilesContainer.innerHTML = "";

      // Create "Start" tile
      const startTile = document.createElement("div");
      startTile.classList.add("tile", "start-tile");
      startTile.innerText = "Start";
      startTile.style.left = `${tilePositions[0][0]}px`;
      startTile.style.top = `${tilePositions[0][1]}px`;
      tilesContainer.appendChild(startTile);

      // Create numbered tiles, last is the castle
      for (let i = 1; i < totalSpaces; i++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.innerText = i === totalSpaces - 1 ? "üè∞" : i;
        tile.style.left = `${tilePositions[i][0]}px`;
        tile.style.top = `${tilePositions[i][1]}px`;
        tilesContainer.appendChild(tile);
      }

      resetPlayer();
    }

    /* ========================================
       MOVE PLAYER
    ======================================= */
    function movePlayer(spaces) {
      playerPosition = Math.min(playerPosition + spaces, totalSpaces - 1);
      const [x, y] = tilePositions[playerPosition];
      const player = document.getElementById("player");
      player.style.left = `${x}px`;
      player.style.top = `${y}px`;

      // Reached the Candy Castle?
      if (playerPosition === totalSpaces - 1) {
        showMessage("üéâ Congratulations! You've reached the Candy Castle!");
        resetPlayer();
      }
    }

    /* ========================================
       RESET PLAYER
    ======================================= */
    function resetPlayer() {
      playerPosition = 0;
      hintsLeft = 3;
      document.getElementById("hints-left").innerText = `Hints Left: ${hintsLeft}`;

      const [x, y] = tilePositions[playerPosition];
      const player = document.getElementById("player");
      player.style.left = `${x}px`;
      player.style.top = `${y}px`;

      // Also close any open popups
      closePopup();
      closeMessagePopup();
    }

    /* ========================================
       CHARACTER SELECTION
    ======================================= */
    function selectCharacter(icon) {
      playerIcon = icon;
      document.getElementById("player").innerText = icon;
      resetPlayer();
    }

    /* ========================================
       SQL CHALLENGES
    ======================================= */
    let currentQuestion = null;

    const sqlQuestions = {
      easy: [
        {
          question: "Find all candy shops in 'Candyland'.",
          answer: "SELECT * FROM candy_shops WHERE location = 'Candyland';"
        },
        {
          question: "Get all candy ingredients that are 'Rare'.",
          answer: "SELECT * FROM candy_ingredients WHERE rarity = 'Rare';"
        }
      ],
      medium: [
        {
          question: "List all unique candy ingredient rarities.",
          answer: "SELECT DISTINCT rarity FROM candy_ingredients;"
        },
        {
          question: "Find the highest-rated candy shops.",
          answer: "SELECT * FROM candy_shops WHERE rating = 5;"
        }
      ],
      advanced: [
        {
          question: "Retrieve candy ingredients and their shop names.",
          answer: "SELECT candy_ingredients.name, candy_shops.name FROM candy_ingredients JOIN candy_shops ON candy_ingredients.shop_id = candy_shops.id;"
        },
        {
          question: "Find the number of ingredients available at each shop.",
          answer: "SELECT COUNT(*) FROM candy_ingredients GROUP BY shop_id;"
        }
      ]
    };

    /* Get question for chosen difficulty, set how many spaces to move. */
    function getQuestion(difficulty) {
      switch(difficulty) {
        case 'easy':
          spacesToMove = 1;
          break;
        case 'medium':
          spacesToMove = 2;
          break;
        case 'advanced':
          spacesToMove = 3;
          break;
      }
      const questionList = sqlQuestions[difficulty];
      currentQuestion = questionList[Math.floor(Math.random() * questionList.length)];

      // Show question in popup
      document.getElementById("question-text").innerText = currentQuestion.question;
      document.getElementById("answer").value = "";
      document.getElementById("question-popup").style.display = "block";
    }

    /* ========================================
       QUESTION SUBMISSION
    ======================================= */
    function submitAnswer() {
      if (!currentQuestion) {
        showMessage("No question is active right now.");
        return;
      }
      const userAnswer = document.getElementById("answer").value.trim();

      if (userAnswer.toLowerCase() === currentQuestion.answer.toLowerCase()) {
        closePopup();
        showMessage("üéâ Correct! Moving forward.");
        movePlayer(spacesToMove);
        currentQuestion = null;
      } else {
        showMessage("‚ùå Incorrect! Try again.");
      }
    }

    /* ========================================
       HINT & SCHEMA
    ======================================= */
    function showHint() {
      if (hintsLeft > 0 && currentQuestion) {
        const keyCondition = currentQuestion.question.split("'")[1] || "the key condition";
        showMessage(`Hint: Think about filtering with WHERE on '${keyCondition}'.`);
        hintsLeft--;
        document.getElementById("hints-left").innerText = `Hints Left: ${hintsLeft}`;
      } else {
        showMessage("No hints left or no active question!");
      }
    }

    function showDatabaseSchema() {
      showMessage(
        "Tables:\n" +
        "1. candy_shops - id, name, location, rating\n" +
        "2. candy_ingredients - id, name, rarity, shop_id"
      );
    }

    /* ========================================
       SHOW ANSWER & CLOSE QUESTION
    ======================================= */
    function showAnswer() {
      if (currentQuestion) {
        showMessage(
          `Answer: ${currentQuestion.answer}\n\n` +
          "Explanation: This query retrieves the requested data using SQL filtering and joins as needed."
        );
        // Immediately close the question popup
        closePopup();
        // Mark the question as finished
        currentQuestion = null;
      }
    }

    /* ========================================
       CUSTOM POPUP CONTROLS
    ======================================= */
    function closePopup() {
      document.getElementById("question-popup").style.display = "none";
    }

    /* ========================================
       CUSTOM MESSAGE POPUP (REPLACES ALERT)
    ======================================= */
    function showMessage(msg) {
      document.getElementById("message-text").innerText = msg;
      document.getElementById("message-popup").style.display = "block";
    }
    function closeMessagePopup() {
      document.getElementById("message-popup").style.display = "none";
    }

    /* ========================================
       ON WINDOW LOAD
    ======================================= */
    window.onload = () => {
      generateTiles();
    };
  </script>
</body>
</html>
