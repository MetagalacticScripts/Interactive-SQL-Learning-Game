<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SQL Candy Quest üç≠</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: linear-gradient(to bottom, #E6F0FA, #EAF7F0);
      font-family: 'Roboto', sans-serif;
      color: #333;
      overflow-x: hidden;
      overflow-y: auto;
    }
    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .sidebar {
      width: 100%;
      background: #FFFFFF;
      border-top: 1px solid #E0E0E0;
      padding: 2vh;
      box-sizing: border-box;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
      order: 2;
      overflow-y: auto;
      max-height: 40vh;
    }
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2vh;
      box-sizing: border-box;
      order: 1;
      overflow-y: auto;
    }
    h2, h3 {
      margin: 1vh 0;
      color: #4A90E2;
      font-weight: 500;
      font-size: clamp(1.5rem, 5vw, 2rem);
    }
    .time-display {
      font-size: clamp(1rem, 4vw, 1.5rem);
      margin: 1vh 0;
      color: #4A90E2;
    }
    #scoreboard {
      margin-top: 2vh;
      border: 1px solid #E0E0E0;
      border-radius: 1vh;
      padding: 1vh;
      background: #FAFAFA;
      box-shadow: 0 0.2vh 1vh rgba(0, 0, 0, 0.05);
    }
    #score-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    #score-list li {
      padding: 0.5vh 0;
      border-bottom: 1px solid #E0E0E0;
      font-size: clamp(0.8rem, 3vw, 1.2rem);
    }
    h1 {
      font-size: clamp(2rem, 8vw, 3rem);
      color: #4A90E2;
      margin: 2vh 0;
      padding: 1vh;
      font-weight: 500;
    }
    .character-select button, .controls button {
      background: #4A90E2;
      color: #FFFFFF;
      border: none;
      padding: clamp(0.5vh, 1vh, 1rem) clamp(1.5vw, 3vw, 2rem);
      margin: 0.5vh;
      border-radius: 0.5vh;
      cursor: pointer;
      font-size: clamp(1rem, 3.5vw, 1.2rem);
      transition: background 0.3s ease, transform 0.2s ease;
      box-shadow: 0 0.2vh 0.6vh rgba(0, 0, 0, 0.1);
    }
    .character-select button:hover, .controls button:hover {
      background: #357ABD;
      transform: scale(1.1);
    }
    #hints-left {
      font-size: clamp(1rem, 3.5vw, 1.2rem);
      color: #4A90E2;
      margin: 0.5vh 0;
    }
    .board {
      width: clamp(80vw, 90vw, 70vw);
      height: clamp(40vh, 50vh, 60vh);
      background: #FFFFFF;
      margin: 1vh 0;
      border-radius: 1vh;
      box-shadow: 0 0.4vh 2vh rgba(0, 0, 0, 0.1);
      position: relative;
      border: 1px solid #E0E0E0;
      overflow: hidden;
    }
    .progress-bar {
      width: clamp(80vw, 90vw, 70vw);
      height: 1.5vh;
      background: #E0E0E0;
      border-radius: 0.5vh;
      margin: 0.5vh 0;
    }
    #progress {
      height: 100%;
      background: linear-gradient(to right, #B3E5FC, #B2DFDB, #B2F0B2);
      border-radius: 0.5vh;
      transition: width 0.5s ease;
    }
    .tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
      gap: 0.5vh;
      width: 100%;
      height: 100%;
      padding: 1vh;
      box-sizing: border-box;
    }
    .tile {
      border-radius: 0.5vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.5rem, 5vw, 2rem);
      font-weight: bold;
      color: #333;
      box-shadow: 0 0.2vh 0.6vh rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
      background: #F0F4FF;
      aspect-ratio: 1 / 1;
    }
    .tile:hover {
      transform: translateY(-0.3vh);
      box-shadow: 0 0.6vh 1.2vh rgba(240, 244, 255, 0.3);
    }
    .start-tile {
      background: #FFD700;
      color: #333;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      border: 1px solid rgba(255, 215, 0, 0.5);
    }
    .sticky-tile {
      background: #FFA500;
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      border: 1px solid rgba(255, 165, 0, 0.5);
    }
    .castle-icon {
      font-size: clamp(2rem, 7vw, 3rem);
    }
    .active-tile {
      box-shadow: 0 0 1.5vh #4A90E2, 0 0 3vh #357ABD;
    }
    #player {
      font-size: clamp(2rem, 8vw, 3rem);
      position: absolute;
      transition: left 0.5s ease-in-out, top 0.5s ease-in-out, transform 0.5s ease-out;
      z-index: 10;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    #player.move {
      transform: scale(1.1);
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #FFFFFF;
      border-radius: 1vh;
      padding: 2vh;
      width: clamp(70vw, 80vw, 50vw);
      max-width: 600px;
      box-shadow: 0 1vh 4vh rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: popIn 0.3s ease-out;
    }
    @keyframes popIn {
      from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    .popup-content {
      background: #FAFAFA;
      border: 1px solid #E0E0E0;
      padding: 1.5vh;
      border-radius: 0.5vh;
      position: relative;
    }
    .popup h2 {
      color: #4A90E2;
      font-size: clamp(1.5rem, 5vw, 1.5rem);
      margin-bottom: 1vh;
      font-weight: 500;
    }
    #answer {
      width: 90%;
      min-height: 15vh;
      padding: 1vh;
      margin: 1vh 0;
      border: 1px solid #E0E0E0;
      border-radius: 0.5vh;
      font-size: clamp(0.8rem, 3vw, 1rem);
      font-family: 'Courier New', monospace;
      background: #FFFFFF;
      outline: none;
      overflow-y: auto;
      user-select: text;
      direction: ltr;
      white-space: pre-wrap;
    }
    #answer[contenteditable]:empty:before {
      content: attr(placeholder);
      color: #aaa;
    }
    .popup-buttons button {
      background: #4A90E2;
      color: #FFFFFF;
      border: none;
      padding: clamp(0.5vh, 1vh, 1rem) clamp(1vw, 2vw, 1rem);
      margin: 0.5vh;
      border-radius: 0.5vh;
      cursor: pointer;
      font-size: clamp(0.8rem, 3vw, 1rem);
      transition: background 0.3s;
    }
    .popup-buttons button:hover {
      background: #357ABD;
    }
    .close-button {
      position: absolute;
      top: 1vh;
      right: 1.5vh;
      background: transparent;
      border: none;
      font-size: clamp(1rem, 4vw, 1.5rem);
      cursor: pointer;
      color: #888;
      transition: color 0.3s;
    }
    .close-button:hover {
      color: #4A90E2;
    }
    #message-popup .popup-content p {
      margin: 0;
      padding: 1vh 0;
      color: #555;
      white-space: pre-wrap;
      font-size: clamp(0.8rem, 3vw, 1rem);
    }
    #final-popup .popup-content {
      text-align: center;
    }
    #final-popup .confetti {
      font-size: clamp(1.5rem, 6vw, 2rem);
      margin-bottom: 1vh;
    }
    #final-popup input {
      width: 80%;
      padding: 1vh;
      margin: 1vh 0;
      border: 1px solid #E0E0E0;
      border-radius: 0.5vh;
      font-size: clamp(0.8rem, 3vw, 1rem);
    }
    @media (min-width: 768px) {
      .container {
        flex-direction: row-reverse;
      }
      .sidebar {
        width: 25vw;
        border-top: none;
        border-left: 1px solid #E0E0E0;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.05);
        max-height: none;
        order: 0;
      }
      .main-content {
        order: 0;
      }
      .board {
        width: 70vw;
        height: 60vh;
      }
      .progress-bar {
        width: 70vw;
      }
      .tiles {
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(4, 1fr);
        gap: 1vh;
      }
      .tile {
        font-size: clamp(2rem, 5vw, 3rem);
      }
      .start-tile {
        font-size: clamp(1.5rem, 4vw, 2rem);
      }
      .sticky-tile {
        font-size: clamp(2rem, 6vw, 3rem);
      }
      .castle-icon {
        font-size: clamp(2.5rem, 7vw, 4rem);
      }
      .controls {
        flex-wrap: nowrap;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <h1>Reach the Candy Castle!</h1>
      <div class="character-select">
        <button onclick="selectCharacter('üç≠')">Lollipop</button>
        <button onclick="selectCharacter('üç¨')">Candy</button>
        <button onclick="selectCharacter('üç´')">Chocolate</button>
      </div>
      <div class="board">
        <div id="tiles-container" class="tiles"></div>
        <div id="player">üç≠</div>
      </div>
      <div class="progress-bar"><div id="progress" style="width: 0%;"></div></div>
      <div class="controls">
        <button onclick="getQuestion('easy')">Easy Path</button>
        <button onclick="getQuestion('medium')">Medium Path</button>
        <button onclick="getQuestion('advanced')">Advanced Path</button>
        <button onclick="resetPlayer()">Reset</button>
      </div>
      <div id="hints-left">Hints Left: 3</div>
    </div>
    <div class="sidebar">
      <h2>SQL Candy Quest üç≠</h2>
      <div class="time-display" id="time-display">Time Elapsed: 0m 0s</div>
      <div id="scoreboard">
        <h3>Scoreboard</h3>
        <ul id="score-list"></ul>
      </div>
    </div>
  </div>
  <div id="question-popup" class="popup">
    <div class="popup-content">
      <button class="close-button" onclick="closePopup()">√ó</button>
      <h2>Sweet Challenge üç¨</h2>
      <p id="question-text"></p>
      <div id="answer" contenteditable="true" placeholder="Type your SQL query here..."></div>
      <div class="popup-buttons">
        <button onclick="submitAnswer()">Submit</button>
        <button onclick="showHint()">Hint</button>
        <button onclick="showDatabaseSchema()">Show Database Schema</button>
        <button onclick="showAnswer()">Show Answer</button>
      </div>
    </div>
  </div>
  <div id="message-popup" class="popup">
    <div class="popup-content">
      <button class="close-button" onclick="closeMessagePopup()">√ó</button>
      <p id="message-text"></p>
      <div class="popup-buttons">
        <button onclick="closeMessagePopup()">OK</button>
      </div>
    </div>
  </div>
  <div id="final-popup" class="popup">
    <div class="popup-content">
      <button class="close-button" onclick="closeFinalPopup()">√ó</button>
      <div class="confetti">üéâüéäüéâüéä</div>
      <p id="final-message"></p>
      <input type="text" id="player-name" placeholder="Enter your name">
      <div class="popup-buttons">
        <button onclick="submitFinalScore()">Submit</button>
      </div>
    </div>
  </div>
  <audio id="sticky-sound" preload="auto">
    <source src="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIA/+MYxDsAAABmQkVHSU4AAyAAAAAAR0lYQVQAAAAA/+MYxB8AAABQTEFZRQAAV2VsY29tZSB0byB0aGUgU29mdHdhcmUgRW5naW5lZXJpbmcgSW5zdGl0dXRlIQAA/+MYxCYAAADQTUVESVRBVElPTgAATWV0YWRhdGEgZm9yIHRoZSBTb2Z0d2FyZSBFbmdpbmVlcmluZyBJbnN0aXR1dGUAAAD/+MYxAwAAAExBTUUzAA==" type="audio/mpeg">
  </audio>
  <audio id="win-sound" preload="auto">
    <source src="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIA/+MYxDsAAABmQkVHSU4AAyAAAAAAR0lYQVQAAAAA/+MYxB8AAABQTEFZRQAAV2lubmluZyBzb3VuZCBmb3IgdGhlIFNvZnR3YXJlIEVuZ2luZWVyaW5nIEluc3RpdHV0ZQAA/+MYxCYAAADQTUVESVRBVElPTgAATWV0YWRhdGEgZm9yIHRoZSBTb2Z0d2FyZSBFbmdpbmVlcmluZyBJbnN0aXR1dGUAAAD/+MYxAwAAAExBTUUzAA==" type="audio/mpeg">
  </audio>
  <script>
    const totalSpaces = 20;
    let playerPosition = 0;
    let hintsLeft = 3;
    let playerIcon = "üç≠";
    let currentQuestion = null;
    let spacesToMove = 1;
    let moveCount = 0;
    let startTime = null;
    let timeInterval = null;
    const scoreboard = [];
    let tilePositions = [];
    const stickyTiles = new Set();
    let stickyAnswersNeeded = 0;
    let currentDifficulty = 'easy';
    const pastelColors = [
      '#F8C8DC', '#B3E5FC', '#D4A5E5', '#C8E6C9', '#FFD1B3',
      '#E6C9F0', '#A3D8F4', '#F5C6CB', '#B2F0B2', '#FFF5B7'
    ];
    const candyIcons = ['üç¨', 'üç´', 'üç≠', 'üç∞', 'üç™', 'üç©', 'üßÅ', 'üçÆ', 'üç¶'];

    const sqlQuestions = {
      easy: [
        { question: "Find all candy shops in 'Candyland'.", answer: "SELECT * FROM candy_shops WHERE location = 'Candyland';" },
        { question: "List all products with a price less than $5.", answer: "SELECT * FROM products WHERE price < 5;" },
        { question: "Get all sales from '2025-01-01'.", answer: "SELECT * FROM sales WHERE sale_date = '2025-01-01';" },
        { question: "Select all products with stock quantity above 100.", answer: "SELECT * FROM products WHERE stock_quantity > 100;" },
        { question: "List shops with a rating of 4 or higher.", answer: "SELECT * FROM candy_shops WHERE rating >= 4;" },
        { question: "Get all products in the 'Chocolate' category.", answer: "SELECT * FROM products WHERE category = 'Chocolate';" },
        { question: "Find sales with quantity sold greater than 10.", answer: "SELECT * FROM sales WHERE quantity_sold > 10;" },
        { question: "List products priced exactly $2.50.", answer: "SELECT * FROM products WHERE price = 2.50;" },
        { question: "Select shops with rating exactly 5.", answer: "SELECT * FROM candy_shops WHERE rating = 5;" },
        { question: "Get sales with total amount over $50.", answer: "SELECT * FROM sales WHERE total_amount > 50;" },
        { question: "Find shops in 'Sugarville'.", answer: "SELECT * FROM candy_shops WHERE location = 'Sugarville';" },
        { question: "List products with category 'Gummy'.", answer: "SELECT * FROM products WHERE category = 'Gummy';" },
        { question: "Get products with stock quantity of 0.", answer: "SELECT * FROM products WHERE stock_quantity = 0;" },
        { question: "Select sales with quantity sold of 1.", answer: "SELECT * FROM sales WHERE quantity_sold = 1;" },
        { question: "Find shops with rating below 3.", answer: "SELECT * FROM candy_shops WHERE rating < 3;" },
        { question: "List products priced between $1 and $3.", answer: "SELECT * FROM products WHERE price BETWEEN 1 AND 3;" },
        { question: "Get sales from '2025-03-07'.", answer: "SELECT * FROM sales WHERE sale_date = '2025-03-07';" },
        { question: "Find products with price greater than $10.", answer: "SELECT * FROM products WHERE price > 10;" },
        { question: "List shops with shop_name starting with 'Candy'.", answer: "SELECT * FROM candy_shops WHERE shop_name LIKE 'Candy%';" },
        { question: "Get products with category 'Hard Candy'.", answer: "SELECT * FROM products WHERE category = 'Hard Candy';" },
        { question: "Select sales with total amount less than $10.", answer: "SELECT * FROM sales WHERE total_amount < 10;" },
        { question: "Find products with stock quantity below 50.", answer: "SELECT * FROM products WHERE stock_quantity < 50;" },
        { question: "List shops in 'Sweet Town'.", answer: "SELECT * FROM candy_shops WHERE location = 'Sweet Town';" },
        { question: "Get products priced under $1.", answer: "SELECT * FROM products WHERE price < 1;" },
        { question: "Select sales from the last week.", answer: "SELECT * FROM sales WHERE sale_date > DATE_SUB(CURDATE(), INTERVAL 7 DAY);" },
        { question: "Find shops with rating of 3.", answer: "SELECT * FROM candy_shops WHERE rating = 3;" },
        { question: "List products with no stock.", answer: "SELECT * FROM products WHERE stock_quantity = 0;" },
        { question: "Get sales with quantity sold between 5 and 10.", answer: "SELECT * FROM sales WHERE quantity_sold BETWEEN 5 AND 10;" },
        { question: "Find products in 'Lollipop' category.", answer: "SELECT * FROM products WHERE category = 'Lollipop';" },
        { question: "List shops with location 'Candy City'.", answer: "SELECT * FROM candy_shops WHERE location = 'Candy City';" },
        { question: "Get products with price exactly $5.", answer: "SELECT * FROM products WHERE price = 5;" },
        { question: "Select sales with total amount exactly $20.", answer: "SELECT * FROM sales WHERE total_amount = 20;" },
        { question: "Find shops with shop_name containing 'Sweet'.", answer: "SELECT * FROM candy_shops WHERE shop_name LIKE '%Sweet%';" },
        { question: "List products with stock quantity over 200.", answer: "SELECT * FROM products WHERE stock_quantity > 200;" },
        { question: "Get sales from '2024-12-31'.", answer: "SELECT * FROM sales WHERE sale_date = '2024-12-31';" },
        { question: "Find products with category 'Caramel'.", answer: "SELECT * FROM products WHERE category = 'Caramel';" },
        { question: "List shops with rating above 2.", answer: "SELECT * FROM candy_shops WHERE rating > 2;" },
        { question: "Get sales with quantity sold less than 3.", answer: "SELECT * FROM sales WHERE quantity_sold < 3;" },
        { question: "Find products priced at $7.99.", answer: "SELECT * FROM products WHERE price = 7.99;" },
        { question: "List shops in 'Choco Land'.", answer: "SELECT * FROM candy_shops WHERE location = 'Choco Land';" },
        { question: "Get products with stock quantity exactly 100.", answer: "SELECT * FROM products WHERE stock_quantity = 100;" },
        { question: "Select sales with total amount over $100.", answer: "SELECT * FROM sales WHERE total_amount > 100;" },
        { question: "Find shops with rating below 4.", answer: "SELECT * FROM candy_shops WHERE rating < 4;" },
        { question: "List products in 'Jelly' category.", answer: "SELECT * FROM products WHERE category = 'Jelly';" },
        { question: "Get sales from '2025-02-14'.", answer: "SELECT * FROM sales WHERE sale_date = '2025-02-14';" },
        { question: "Find products with price less than $2.", answer: "SELECT * FROM products WHERE price < 2;" },
        { question: "List shops with shop_name ending in 'Shop'.", answer: "SELECT * FROM candy_shops WHERE shop_name LIKE '%Shop';" },
        { question: "Get products with stock quantity below 10.", answer: "SELECT * FROM products WHERE stock_quantity < 10;" },
        { question: "Select sales with quantity sold over 20.", answer: "SELECT * FROM sales WHERE quantity_sold > 20;" },
        { question: "Find shops in 'Gummyville'.", answer: "SELECT * FROM candy_shops WHERE location = 'Gummyville';" }
      ],
      medium: [
        { question: "Find total quantity sold per product.", answer: "SELECT p.product_name, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name;" },
        { question: "List shops and their total sales amount.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name;" },
        { question: "Get products with average sale amount over $20.", answer: "SELECT p.product_name, AVG(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name HAVING AVG(s.total_amount) > 20;" },
        { question: "Find top 3 highest-priced products.", answer: "SELECT product_name, price FROM products ORDER BY price DESC LIMIT 3;" },
        { question: "List shops with no sales in 2025.", answer: "SELECT shop_name FROM candy_shops WHERE shop_id NOT IN (SELECT shop_id FROM sales WHERE sale_date LIKE '2025%');" },
        { question: "Get total stock quantity per product category.", answer: "SELECT category, SUM(stock_quantity) FROM products GROUP BY category;" },
        { question: "Find products not sold in the last month.", answer: "SELECT p.product_name FROM products p WHERE p.product_id NOT IN (SELECT product_id FROM sales WHERE sale_date > DATE_SUB(CURDATE(), INTERVAL 1 MONTH));" },
        { question: "List shops with average rating above 4.", answer: "SELECT shop_name, rating FROM candy_shops WHERE rating > 4;" },
        { question: "Get total sales per month in 2025.", answer: "SELECT MONTH(sale_date), SUM(total_amount) FROM sales WHERE sale_date LIKE '2025%' GROUP BY MONTH(sale_date);" },
        { question: "Find products with stock below 10.", answer: "SELECT product_name, stock_quantity FROM products WHERE stock_quantity < 10;" },
        { question: "List top 5 best-selling products by quantity.", answer: "SELECT p.product_name, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name ORDER BY SUM(s.quantity_sold) DESC LIMIT 5;" },
        { question: "Get average price per product category.", answer: "SELECT category, AVG(price) FROM products GROUP BY category;" },
        { question: "Find shops with total sales over $500.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > 500;" },
        { question: "List products with no sales.", answer: "SELECT product_name FROM products WHERE product_id NOT IN (SELECT product_id FROM sales);" },
        { question: "Get total sales amount per shop in 'Candyland'.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE cs.location = 'Candyland' GROUP BY cs.shop_name;" },
        { question: "Find products sold more than 100 times.", answer: "SELECT p.product_name, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name HAVING SUM(s.quantity_sold) > 100;" },
        { question: "List shops with rating below average.", answer: "SELECT shop_name, rating FROM candy_shops WHERE rating < (SELECT AVG(rating) FROM candy_shops);" },
        { question: "Get total sales per product category.", answer: "SELECT p.category, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.category;" },
        { question: "Find shops with sales in the last week.", answer: "SELECT DISTINCT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE s.sale_date > DATE_SUB(CURDATE(), INTERVAL 7 DAY);" },
        { question: "List products with price above category average.", answer: "SELECT p.product_name, p.price FROM products p WHERE p.price > (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category);" },
        { question: "Get total quantity sold per shop.", answer: "SELECT cs.shop_name, SUM(s.quantity_sold) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name;" },
        { question: "Find products with total sales amount over $1000.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name HAVING SUM(s.total_amount) > 1000;" },
        { question: "List shops with no products under $5.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.price < 5);" },
        { question: "Get average sale amount per day.", answer: "SELECT sale_date, AVG(total_amount) FROM sales GROUP BY sale_date;" },
        { question: "Find products with stock equal to total sold.", answer: "SELECT p.product_name, p.stock_quantity, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.stock_quantity HAVING p.stock_quantity = SUM(s.quantity_sold);" },
        { question: "List shops with sales exceeding 50 items.", answer: "SELECT cs.shop_name, SUM(s.quantity_sold) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(s.quantity_sold) > 50;" },
        { question: "Get total sales for 'Chocolate' category.", answer: "SELECT SUM(s.total_amount) FROM sales s JOIN products p ON s.product_id = p.product_id WHERE p.category = 'Chocolate';" },
        { question: "Find products with no sales in 2025.", answer: "SELECT p.product_name FROM products p WHERE p.product_id NOT IN (SELECT product_id FROM sales WHERE sale_date LIKE '2025%');" },
        { question: "List shops with average sale amount over $30.", answer: "SELECT cs.shop_name, AVG(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING AVG(s.total_amount) > 30;" },
        { question: "Get total stock value per category.", answer: "SELECT category, SUM(price * stock_quantity) FROM products GROUP BY category;" },
        { question: "Find shops with sales in 'Sugarville'.", answer: "SELECT DISTINCT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE cs.location = 'Sugarville';" },
        { question: "List products with price below average.", answer: "SELECT product_name, price FROM products WHERE price < (SELECT AVG(price) FROM products);" },
        { question: "Get total sales per shop in 2024.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE s.sale_date LIKE '2024%' GROUP BY cs.shop_name;" },
        { question: "Find products sold in all shops.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT cs.shop_id FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s WHERE s.shop_id = cs.shop_id AND s.product_id = p.product_id));" },
        { question: "List shops with more than 10 sales.", answer: "SELECT cs.shop_name, COUNT(s.sale_id) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING COUNT(s.sale_id) > 10;" },
        { question: "Get average quantity sold per product.", answer: "SELECT p.product_name, AVG(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name;" },
        { question: "Find shops with no 'Gummy' sales.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.category = 'Gummy');" },
        { question: "List products sorted by total sales amount.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name ORDER BY SUM(s.total_amount) DESC;" },
        { question: "Get total sales per day in January 2025.", answer: "SELECT sale_date, SUM(total_amount) FROM sales WHERE sale_date LIKE '2025-01%' GROUP BY sale_date;" },
        { question: "Find shops with rating above average sales.", answer: "SELECT cs.shop_name, cs.rating FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name, cs.rating HAVING cs.rating > (SELECT AVG(rating) FROM candy_shops);" },
        { question: "List products with stock below average.", answer: "SELECT product_name, stock_quantity FROM products WHERE stock_quantity < (SELECT AVG(stock_quantity) FROM products);" },
        { question: "Get total quantity sold per category.", answer: "SELECT p.category, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.category;" },
        { question: "Find shops with sales over $1000 in 2025.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE s.sale_date LIKE '2025%' GROUP BY cs.shop_name HAVING SUM(s.total_amount) > 1000;" },
        { question: "List products with sales in 'Candyland' only.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.location = 'Candyland' AND p.product_id NOT IN (SELECT s2.product_id FROM sales s2 JOIN candy_shops cs2 ON s2.shop_id = cs2.shop_id WHERE cs2.location != 'Candyland');" },
        { question: "Get average sale amount per shop.", answer: "SELECT cs.shop_name, AVG(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name;" },
        { question: "Find products with sales exceeding stock.", answer: "SELECT p.product_name, SUM(s.quantity_sold), p.stock_quantity FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.stock_quantity HAVING SUM(s.quantity_sold) > p.stock_quantity;" },
        { question: "List shops with sales in every category.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT DISTINCT p.category FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p2 ON s.product_id = p2.product_id WHERE s.shop_id = cs.shop_id AND p2.category = p.category));" },
        { question: "Get total sales per product in 'Sugarville'.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.location = 'Sugarville' GROUP BY p.product_name;" },
        { question: "Find shops with no sales under $10.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s WHERE s.shop_id = cs.shop_id AND s.total_amount < 10);" }
      ],
      advanced: [
        { question: "Find the most popular product per shop by quantity sold.", answer: "SELECT cs.shop_name, p.product_name, SUM(s.quantity_sold) as total_sold FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.product_name HAVING total_sold = (SELECT SUM(s2.quantity_sold) FROM sales s2 WHERE s2.shop_id = cs.shop_id GROUP BY s2.product_id ORDER BY SUM(s2.quantity_sold) DESC LIMIT 1);" },
        { question: "List shops with sales exceeding average stock value.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > (SELECT AVG(p.price * p.stock_quantity) FROM products p JOIN sales s2 ON p.product_id = s2.product_id WHERE s2.shop_id = cs.shop_id GROUP BY s2.shop_id);" },
        { question: "Find products sold in all shops.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT cs.shop_id FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s WHERE s.shop_id = cs.shop_id AND s.product_id = p.product_id));" },
        { question: "Get shops with above-average sales per category.", answer: "SELECT cs.shop_name, p.category, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.category HAVING SUM(s.total_amount) > (SELECT AVG(SUM(s2.total_amount)) FROM sales s2 JOIN products p2 ON s2.product_id = p2.product_id WHERE p2.category = p.category GROUP BY s2.shop_id);" },
        { question: "Find shops with no sales of low-stock products.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.stock_quantity < 10);" },
        { question: "List products outselling their category average.", answer: "SELECT p.product_name, SUM(s.quantity_sold) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.category HAVING SUM(s.quantity_sold) > (SELECT AVG(SUM(s2.quantity_sold)) FROM products p2 JOIN sales s2 ON p2.product_id = s2.product_id WHERE p2.category = p.category GROUP BY p2.product_id);" },
        { question: "Get shops with sales growth over last year.", answer: "SELECT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(CASE WHEN YEAR(s.sale_date) = YEAR(CURDATE()) THEN s.total_amount ELSE 0 END) > SUM(CASE WHEN YEAR(s.sale_date) = YEAR(CURDATE()) - 1 THEN s.total_amount ELSE 0 END);" },
        { question: "Find products with sales in every month of 2025.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id WHERE YEAR(s.sale_date) = 2025 GROUP BY p.product_name HAVING COUNT(DISTINCT MONTH(s.sale_date)) = 12;" },
        { question: "List shops with exclusive category sales.", answer: "SELECT cs.shop_name, p.category FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.category HAVING COUNT(DISTINCT p.category) = 1;" },
        { question: "Get total sales per shop exceeding stock value.", answer: "SELECT cs.shop_name, SUM(s.total_amount), SUM(p.price * p.stock_quantity) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > SUM(p.price * p.stock_quantity);" },
        { question: "Find shops with no sales of 'Chocolate' products.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.category = 'Chocolate');" },
        { question: "List products with sales exceeding twice their stock.", answer: "SELECT p.product_name, SUM(s.quantity_sold), p.stock_quantity FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.stock_quantity HAVING SUM(s.quantity_sold) > 2 * p.stock_quantity;" },
        { question: "Get shops with highest sales per category.", answer: "SELECT cs.shop_name, p.category, SUM(s.total_amount) as total FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.category HAVING total = (SELECT SUM(s2.total_amount) FROM sales s2 JOIN products p2 ON s2.product_id = p2.product_id WHERE p2.category = p.category GROUP BY s2.shop_id ORDER BY SUM(s2.total_amount) DESC LIMIT 1);" },
        { question: "Find products with no sales in high-rated shops.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE s.product_id = p.product_id AND cs.rating >= 4);" },
        { question: "List shops with sales in all price ranges.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT DISTINCT FLOOR(p.price / 5) * 5 as price_range FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p2 ON s.product_id = p2.product_id WHERE s.shop_id = cs.shop_id AND FLOOR(p2.price / 5) * 5 = FLOOR(p.price / 5) * 5));" },
        { question: "Get total sales per shop and category.", answer: "SELECT cs.shop_name, p.category, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.category;" },
        { question: "Find shops with declining sales trend.", answer: "SELECT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(CASE WHEN YEAR(s.sale_date) = YEAR(CURDATE()) THEN s.total_amount ELSE 0 END) < SUM(CASE WHEN YEAR(s.sale_date) = YEAR(CURDATE()) - 1 THEN s.total_amount ELSE 0 END);" },
        { question: "List products with consistent daily sales in 2025.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id WHERE s.sale_date LIKE '2025-01%' GROUP BY p.product_name HAVING COUNT(DISTINCT s.sale_date) = DAY(LAST_DAY('2025-01-01'));" },
        { question: "Get shops with sales exceeding average category sales.", answer: "SELECT cs.shop_name, p.category, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.category HAVING SUM(s.total_amount) > (SELECT AVG(SUM(s2.total_amount)) FROM sales s2 JOIN products p2 ON s2.product_id = p2.product_id WHERE p2.category = p.category GROUP BY s2.shop_id);" },
        { question: "Find products with sales in top-rated shops only.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.rating = 5 AND p.product_id NOT IN (SELECT s2.product_id FROM sales s2 JOIN candy_shops cs2 ON s2.shop_id = cs2.shop_id WHERE cs2.rating < 5);" },
        { question: "List shops with no sales below average price.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.price < (SELECT AVG(price) FROM products));" },
        { question: "Get total sales per shop with low stock products.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id WHERE p.stock_quantity < 10 GROUP BY cs.shop_name;" },
        { question: "Find products with sales in every shop location.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT DISTINCT cs.location FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN candy_shops cs2 ON s.shop_id = cs2.shop_id WHERE s.product_id = p.product_id AND cs2.location = cs.location));" },
        { question: "List shops with sales exceeding stock in 2025.", answer: "SELECT cs.shop_name, SUM(s.quantity_sold), SUM(p.stock_quantity) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id WHERE s.sale_date LIKE '2025%' GROUP BY cs.shop_name HAVING SUM(s.quantity_sold) > SUM(p.stock_quantity);" },
        { question: "Get shops with highest sales per product.", answer: "SELECT cs.shop_name, p.product_name, SUM(s.total_amount) as total FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name, p.product_name HAVING total = (SELECT SUM(s2.total_amount) FROM sales s2 WHERE s2.product_id = p.product_id GROUP BY s2.shop_id ORDER BY SUM(s2.total_amount) DESC LIMIT 1);" },
        { question: "Find products with no sales in low-rated shops.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE s.product_id = p.product_id AND cs.rating < 3);" },
        { question: "List shops with sales in every month of 2025.", answer: "SELECT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE s.sale_date LIKE '2025%' GROUP BY cs.shop_name HAVING COUNT(DISTINCT MONTH(s.sale_date)) = 12;" },
        { question: "Get total sales per category in top-rated shops.", answer: "SELECT p.category, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.rating = 5 GROUP BY p.category;" },
        { question: "Find shops with no sales of high-priced products.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.price > (SELECT AVG(price) FROM products));" },
        { question: "List products with sales exceeding category median.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.category HAVING SUM(s.total_amount) > (SELECT SUM(s2.total_amount) FROM sales s2 JOIN products p2 ON s2.product_id = p2.product_id WHERE p2.category = p.category GROUP BY p2.product_id ORDER BY SUM(s2.total_amount) LIMIT 1 OFFSET (SELECT COUNT(*) / 2 FROM products p3 WHERE p3.category = p.category));" },
        { question: "Get shops with sales in 'Candyland' exceeding others.", answer: "SELECT cs.shop_name FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE cs.location = 'Candyland' GROUP BY cs.shop_name HAVING SUM(s.total_amount) > (SELECT SUM(s2.total_amount) FROM sales s2 JOIN candy_shops cs2 ON s2.shop_id = cs2.shop_id WHERE cs2.location != 'Candyland' GROUP BY cs2.shop_id ORDER BY SUM(s2.total_amount) DESC LIMIT 1);" },
        { question: "Find products with sales in all rating levels.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT DISTINCT FLOOR(cs.rating) as rating_level FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN candy_shops cs2 ON s.shop_id = cs2.shop_id WHERE s.product_id = p.product_id AND FLOOR(cs2.rating) = FLOOR(cs.rating)));" },
        { question: "List shops with sales doubling stock value.", answer: "SELECT cs.shop_name, SUM(s.total_amount), SUM(p.price * p.stock_quantity) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > 2 * SUM(p.price * p.stock_quantity);" },
        { question: "Get total sales per shop in low-stock categories.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id WHERE p.category IN (SELECT category FROM products GROUP BY category HAVING AVG(stock_quantity) < 10) GROUP BY cs.shop_name;" },
        { question: "Find shops with no sales in 2024.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s WHERE s.shop_id = cs.shop_id AND s.sale_date LIKE '2024%');" },
        { question: "List products with sales in 'Sugarville' only.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.location = 'Sugarville' AND p.product_id NOT IN (SELECT s2.product_id FROM sales s2 JOIN candy_shops cs2 ON s2.shop_id = cs2.shop_id WHERE cs2.location != 'Sugarville');" },
        { question: "Get shops with sales exceeding average shop sales.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > (SELECT AVG(SUM(total_amount)) FROM sales GROUP BY shop_id);" },
        { question: "Find products with no sales in 'Candyland'.", answer: "SELECT p.product_name FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE s.product_id = p.product_id AND cs.location = 'Candyland');" },
        { question: "List shops with sales in top 3 categories.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT p.category FROM (SELECT p2.category FROM products p2 JOIN sales s2 ON p2.product_id = s2.product_id GROUP BY p2.category ORDER BY SUM(s2.total_amount) DESC LIMIT 3) top_cats WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p3 ON s.product_id = p3.product_id WHERE s.shop_id = cs.shop_id AND p3.category = top_cats.category));" },
        { question: "Get total sales per product in high-rated shops.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.rating >= 4 GROUP BY p.product_name;" },
        { question: "Find shops with sales in every stock level.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT DISTINCT FLOOR(p.stock_quantity / 50) * 50 as stock_level FROM products p WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p2 ON s.product_id = p2.product_id WHERE s.shop_id = cs.shop_id AND FLOOR(p2.stock_quantity / 50) * 50 = FLOOR(p.stock_quantity / 50) * 50));" },
        { question: "List products with sales doubling category average.", answer: "SELECT p.product_name, SUM(s.total_amount) FROM products p JOIN sales s ON p.product_id = s.product_id GROUP BY p.product_name, p.category HAVING SUM(s.total_amount) > 2 * (SELECT AVG(SUM(s2.total_amount)) FROM sales s2 JOIN products p2 ON s2.product_id = p2.product_id WHERE p2.category = p.category GROUP BY p2.product_id);" },
        { question: "Get shops with no sales of 'Gummy' in 2025.", answer: "SELECT cs.shop_name FROM candy_shops cs WHERE NOT EXISTS (SELECT 1 FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.shop_id = cs.shop_id AND p.category = 'Gummy' AND s.sale_date LIKE '2025%');" },
        { question: "Find products with sales in 'Choco Land' exceeding others.", answer: "SELECT p.product_name FROM products p JOIN sales s ON p.product_id = s.product_id JOIN candy_shops cs ON s.shop_id = cs.shop_id WHERE cs.location = 'Choco Land' GROUP BY p.product_name HAVING SUM(s.total_amount) > (SELECT SUM(s2.total_amount) FROM sales s2 JOIN candy_shops cs2 ON s2.shop_id = cs2.shop_id WHERE s2.product_id = p.product_id AND cs2.location != 'Choco Land');" },
        { question: "List shops with sales exceeding total stock value.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id JOIN products p ON s.product_id = p.product_id GROUP BY cs.shop_name HAVING SUM(s.total_amount) > (SELECT SUM(price * stock_quantity) FROM products);" },
        { question: "Get total sales per shop in 'Gummyville'.", answer: "SELECT cs.shop_name, SUM(s.total_amount) FROM candy_shops cs JOIN sales s ON cs.shop_id = s.shop_id WHERE cs.location = 'Gummyville' GROUP BY cs.shop_id;" }
      ]
    };
    const usedQuestions = {
      easy: new Set(),
      medium: new Set(),
      advanced: new Set(),
    };

    window.onload = () => {
      generateTilePositions();
      generateTiles();
      startTime = Date.now();
      timeInterval = setInterval(updateTimer, 1000);
      loadScoreboard();
      setupSyntaxHighlighting();
      updateProgress();
      window.addEventListener('resize', () => {
        generateTilePositions();
        generateTiles();
        placePlayer();
      });
      document.getElementById('tiles-container').addEventListener('touchstart', handleTouchStart);
      document.getElementById('tiles-container').addEventListener('touchmove', handleTouchMove);
      document.getElementById('tiles-container').addEventListener('touchend', handleTouchEnd);
    };

    let touchStartX = 0;
    let touchStartY = 0;

    function handleTouchStart(e) {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }

    function handleTouchMove(e) {
      e.preventDefault();
    }

    function handleTouchEnd(e) {
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
        if (deltaX > 0 && playerPosition < totalSpaces - 1) {
          getQuestion('easy');
        }
      }
    }

    function generateTilePositions() {
      tilePositions = [];
      const board = document.querySelector('.board');
      const tilesContainer = document.getElementById('tiles-container');
      const boardRect = board.getBoundingClientRect();
      const tileElements = tilesContainer.children;
      if (tileElements.length === 0) return;
      for (let i = 0; i < totalSpaces; i++) {
        const tileRect = tileElements[i].getBoundingClientRect();
        const x = tileRect.left - boardRect.left + (tileRect.width - tileRect.width * 0.8) / 2;
        const y = tileRect.top - boardRect.top + (tileRect.height - tileRect.height * 0.8) / 2;
        tilePositions.push([x, y]);
      }
    }

    function generateTiles() {
      const container = document.getElementById("tiles-container");
      container.innerHTML = "";
      stickyTiles.clear();
      for (let i = 0; i < totalSpaces; i++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.style.background = pastelColors[Math.floor(Math.random() * pastelColors.length)];
        if (i === 0) {
          tile.classList.add("start-tile");
          tile.innerText = "Start";
        } else if (i === totalSpaces - 1) {
          tile.style.background = "#FFFACD";
          tile.innerHTML = `<span class="castle-icon">üè∞</span>`;
        } else {
          if (Math.random() < 0.2 && i !== 0 && i !== totalSpaces - 1) {
            tile.classList.add("sticky-tile");
            tile.innerText = "üçØ";
            stickyTiles.add(i);
          } else {
            tile.innerText = candyIcons[Math.floor(Math.random() * candyIcons.length)];
          }
        }
        container.appendChild(tile);
      }
      setTimeout(() => {
        generateTilePositions();
        placePlayer();
      }, 0);
    }

    function resetPlayer() {
      playerPosition = 0;
      hintsLeft = 3;
      moveCount = 0;
      stickyAnswersNeeded = 0;
      startTime = Date.now();
      if (timeInterval) clearInterval(timeInterval);
      timeInterval = setInterval(updateTimer, 1000);
      document.getElementById("hints-left").innerText = `Hints Left: ${hintsLeft}`;
      document.getElementById("time-display").innerText = "Time Elapsed: 0m 0s";
      placePlayer();
      closePopup();
      closeMessagePopup();
      updateProgress();
      usedQuestions.easy.clear();
      usedQuestions.medium.clear();
      usedQuestions.advanced.clear();
    }

    function placePlayer() {
      const player = document.getElementById("player");
      const tiles = document.querySelectorAll(".tile");
      tiles.forEach((tile, index) => {
        tile.classList.toggle("active-tile", index === playerPosition);
      });
      if (tilePositions[playerPosition]) {
        const [x, y] = tilePositions[playerPosition];
        player.style.left = x + "px";
        player.style.top = y + "px";
        player.classList.remove("move");
        void player.offsetWidth;
        player.classList.add("move");
      }
      updateProgress();
    }

    function updateProgress() {
      const progress = (playerPosition / (totalSpaces - 1)) * 100;
      document.getElementById("progress").style.width = `${progress}%`;
    }

    function selectCharacter(icon) {
      playerIcon = icon;
      document.getElementById("player").innerText = icon;
      placePlayer();
    }

    function movePlayer(spaces) {
      moveCount++;
      const newPosition = Math.min(playerPosition + spaces, totalSpaces - 1);
      playerPosition = newPosition;
      placePlayer();
      if (playerPosition === totalSpaces - 1) {
        document.getElementById("win-sound").play();
        showFinalPopup();
      } else if (stickyTiles.has(playerPosition)) {
        document.getElementById("sticky-sound").play();
        if (stickyAnswersNeeded === 0) {
          stickyAnswersNeeded = 2;
          showMessage("You are stuck on a sticky honey tile. You must answer two questions correctly to proceed.");
          setTimeout(() => getQuestion(currentDifficulty), 1000);
        }
      }
    }

    function updateTimer() {
      const elapsedSec = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsedSec / 60);
      const seconds = elapsedSec % 60;
      document.getElementById("time-display").innerText = `Time Elapsed: ${minutes}m ${seconds}s`;
    }

    function loadScoreboard() {
      const saved = localStorage.getItem("scoreboard");
      if (saved) {
        scoreboard.push(...JSON.parse(saved));
        updateScoreboardDisplay();
      }
    }

    function saveScoreboard() {
      localStorage.setItem("scoreboard", JSON.stringify(scoreboard));
    }

    function updateScoreboard(playerName) {
      const elapsedSec = Math.floor((Date.now() - startTime) / 1000);
      const score = { name: playerName, time: elapsedSec, moves: moveCount };
      scoreboard.push(score);
      scoreboard.sort((a, b) => a.time - b.time);
      if (scoreboard.length > 10) scoreboard.pop();
      updateScoreboardDisplay();
      saveScoreboard();
    }

    function updateScoreboardDisplay() {
      const list = document.getElementById("score-list");
      list.innerHTML = "";
      scoreboard.forEach((entry, index) => {
        const li = document.createElement("li");
        li.innerText = `${index + 1}. ${entry.name} - ${Math.floor(entry.time / 60)}m ${entry.time % 60}s (${entry.moves} moves)`;
        list.appendChild(li);
      });
    }

    function getQuestion(difficulty) {
      if (playerPosition >= totalSpaces - 1) {
        showMessage("You have already reached the Candy Castle!");
        return;
      }

      currentDifficulty = difficulty;
      spacesToMove = difficulty === 'easy' ? 1 : difficulty === 'medium' ? 2 : 3;

      const pool = sqlQuestions[difficulty];
      const used = usedQuestions[difficulty];
      const available = pool.filter((q, idx) => !used.has(idx));
      if (available.length === 0) {
        used.clear();
        showMessage("All questions for this difficulty have been used. Resetting question pool.");
      }
      const updatedAvailable = pool.filter((q, idx) => !used.has(idx));
      if (updatedAvailable.length === 0) {
        showMessage("Error: No questions available after reset.");
        return;
      }
      const randIndex = Math.floor(Math.random() * updatedAvailable.length);
      currentQuestion = updatedAvailable[randIndex];
      const originalIndex = pool.indexOf(currentQuestion);
      used.add(originalIndex);

      document.getElementById("question-text").innerText = currentQuestion.question;
      const answerDiv = document.getElementById("answer");
      answerDiv.innerHTML = "";
      answerDiv.focus();
      document.getElementById("question-popup").style.display = "block";
    }

    function setupSyntaxHighlighting() {
      const answerDiv = document.getElementById("answer");
      answerDiv.addEventListener("input", function() {
        const text = this.innerText;
        const highlighted = text
          .replace(/\b(SELECT|FROM|WHERE|JOIN|GROUP|BY|HAVING|ORDER|LIMIT|NOT|IN|AND|OR|AS|SUM|AVG|COUNT|DISTINCT)\b/gi, '<span class="sql-keyword">$1</span>')
          .replace(/'[^']*'/gi, '<span class="sql-string">$&</span>')
          .replace(/\b\d+(\.\d+)?\b/gi, '<span class="sql-number">$&</span>');
        this.innerHTML = highlighted;
        const range = document.createRange();
        const sel = window.getSelection();
        range.selectNodeContents(this);
        range.collapse(false);
        sel.removeAllRanges();
        sel.addRange(range);
      });
    }

    function submitAnswer() {
      if (!currentQuestion) {
        showMessage("Please select a question first.");
        return;
      }
      const answerDiv = document.getElementById("answer");
      const userAnswer = answerDiv.innerText.trim();
      const correctAnswer = currentQuestion.answer.trim();
      if (userAnswer === correctAnswer) {
        closePopup();
        if (stickyAnswersNeeded > 0) {
          stickyAnswersNeeded--;
          if (stickyAnswersNeeded > 0) {
            showMessage(`Correct! One more correct answer is required to pass the sticky honey tile. (${stickyAnswersNeeded} left)`);
            setTimeout(() => getQuestion(currentDifficulty), 1000);
          } else {
            showMessage("Correct! You have cleared the sticky honey tile. You may proceed on your next turn.");
          }
        } else {
          movePlayer(spacesToMove);
          showMessage("Correct! You moved forward!");
        }
      } else {
        showMessage("Incorrect answer. Try again or use a hint!");
      }
    }

    function showHint() {
      if (hintsLeft <= 0) {
        showMessage("No hints left!");
        return;
      }
      if (!currentQuestion) {
        showMessage("There is no active question to show a hint for.");
        return;
      }
      hintsLeft--;
      const hintText = currentQuestion.answer.split(" ").slice(0, Math.floor(currentQuestion.answer.split(" ").length / 2)).join(" ") + " ...";
      showMessage(`Hint: ${hintText}\nHints Left: ${hintsLeft}`);
      document.getElementById("hints-left").innerText = `Hints Left: ${hintsLeft}`;
    }

    function showDatabaseSchema() {
      showMessage(
        "candy_shops\n" +
        "  shop_id: INT PRIMARY KEY\n" +
        "  shop_name: VARCHAR(100) NOT NULL\n" +
        "  location: VARCHAR(100)\n" +
        "  rating: DECIMAL(2,1) CHECK (rating >= 0 AND rating <= 5)\n\n" +
        "products\n" +
        "  product_id: INT PRIMARY KEY\n" +
        "  product_name: VARCHAR(100) NOT NULL\n" +
        "  category: VARCHAR(50)\n" +
        "  price: DECIMAL(10,2)\n" +
        "  stock_quantity: INT\n\n" +
        "sales\n" +
        "  sale_id: INT PRIMARY KEY\n" +
        "  shop_id: INT\n" +
        "  product_id: INT\n" +
        "  sale_date: DATE\n" +
        "  quantity_sold: INT\n" +
        "  total_amount: DECIMAL(10,2)\n" +
        "  FOREIGN KEY (shop_id) REFERENCES candy_shops(shop_id)\n" +
        "  FOREIGN KEY (product_id) REFERENCES products(product_id)"
      );
    }

    function showAnswer() {
      if (!currentQuestion) {
        showMessage("There is no active question to show the answer for.");
        return;
      }
      showMessage(`The correct answer is:\n${currentQuestion.answer}`);
      closePopup();
      setTimeout(() => getQuestion(currentDifficulty), 1000);
    }

    function showMessage(message) {
      const popup = document.getElementById("message-popup");
      const messageText = document.getElementById("message-text");
      messageText.innerText = message;
      popup.style.display = "block";
    }

    function closePopup() {
      document.getElementById("question-popup").style.display = "none";
      currentQuestion = null;
    }

    function closeMessagePopup() {
      document.getElementById("message-popup").style.display = "none";
    }

    function showFinalPopup() {
      const elapsedSec = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsedSec / 60);
      const seconds = elapsedSec % 60;
      document.getElementById("final-message").innerText = `Congratulations! You reached the Candy Castle in ${minutes}m ${seconds}s with ${moveCount} moves!`;
      document.getElementById("final-popup").style.display = "block";
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
      clearInterval(timeInterval);
    }

    function closeFinalPopup() {
      document.getElementById("final-popup").style.display = "none";
    }

    function submitFinalScore() {
      const playerName = document.getElementById("player-name").value.trim();
      if (playerName) {
        updateScoreboard(playerName);
        closeFinalPopup();
        resetPlayer();
      } else {
        showMessage("Please enter your name!");
      }
    }
  </script>
</body>
</html>